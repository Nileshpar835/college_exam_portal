{% extends 'base.html' %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3>{{ quiz.title }}</h3>
                </div>
                <div class="card-body">
                    <p><strong>Description:</strong> {{ quiz.description }}</p>
                    <p><strong>Duration:</strong> {{ quiz.duration }} minutes</p>
                    <p><strong>Passing Score:</strong> {{ quiz.passing_score }}%</p>
                    <p><strong>Created by:</strong> {{ quiz.creator.username }}</p>
                    <p><strong>Created on:</strong> {{ quiz.created_at|date }}</p>
                    
                    <div class="mt-4">
                        <h4>Questions ({{ quiz.question_set.count }})</h4>
                        {% for question in quiz.question_set.all %}
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6>{{ forloop.counter }}. {{ question.text }}</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p>1. {{ question.option_1 }} {% if question.correct_answer == 1 %}<span class="badge bg-success">Correct</span>{% endif %}</p>
                                        <p>2. {{ question.option_2 }} {% if question.correct_answer == 2 %}<span class="badge bg-success">Correct</span>{% endif %}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p>3. {{ question.option_3 }} {% if question.correct_answer == 3 %}<span class="badge bg-success">Correct</span>{% endif %}</p>
                                        <p>4. {{ question.option_4 }} {% if question.correct_answer == 4 %}<span class="badge bg-success">Correct</span>{% endif %}</p>
                                    </div>
                                </div>
                                <p><strong>Marks:</strong> {{ question.marks }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Actions</h5>
                </div>
                <div class="card-body">
                    {% if user.role == 'STUDENT' %}
                        {% with user_result=quiz.user_results %}
                            {% if user_result %}
                                <div class="alert alert-success">
                                    <small>
                                        <i class="fas fa-check-circle"></i> <strong>Quiz Completed</strong>
                                        <br>Date: {{ user_result.completed_at|date:"M d, Y g:i A" }}
                                        <br>Score: {{ user_result.score }}%
                                        {% if user_result.passed %}
                                            <br><span class="badge bg-success">Passed</span>
                                        {% else %}
                                            <br><span class="badge bg-danger">Failed</span>
                                        {% endif %}
                                    </small>
                                </div>
                                <button class="btn btn-secondary w-100 mb-2" disabled>
                                    <i class="fas fa-lock"></i> Quiz Already Taken
                                </button>
                                <a href="{% url 'exams:quiz_result' user_result.id %}" class="btn btn-primary w-100 mb-2">
                                    <i class="fas fa-eye"></i> View Detailed Result
                                </a>
                            {% else %}
                                <div class="alert alert-info">
                                    <small>
                                        <i class="fas fa-info-circle"></i> You haven't taken this quiz yet.
                                        <br>Duration: {{ quiz.duration }} minutes
                                        <br>Questions: {{ quiz.question_set.count }}
                                        <br>Passing Score: {{ quiz.passing_score }}%
                                    </small>
                                </div>
                                <a href="{% url 'exams:quiz_attempt' quiz.id %}" class="btn btn-primary w-100 mb-2">
                                    <i class="fas fa-play"></i> Take Quiz
                                </a>
                            {% endif %}
                        {% endwith %}
                    {% else %}
                        {% if user == quiz.creator or user.role == 'HOD' %}
                            <a href="{% url 'exams:quiz_edit' quiz.id %}" class="btn btn-warning w-100 mb-2">Edit Quiz</a>
                            <a href="{% url 'exams:quiz_delete' quiz.id %}" class="btn btn-danger w-100 mb-2">Delete Quiz</a>
                        {% endif %}
                    {% endif %}
                    <a href="{% url 'exams:quiz_list' %}" class="btn btn-secondary w-100">Back to Quiz List</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
